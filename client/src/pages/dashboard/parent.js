"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = ParentDashboard;
var jsx_runtime_1 = require("react/jsx-runtime");
var react_query_1 = require("@tanstack/react-query");
var ParentLayout_1 = require("@/components/ParentLayout");
var card_1 = require("@/components/ui/card");
var badge_1 = require("@/components/ui/badge");
var ProgressBar_1 = require("@/components/ProgressBar");
var tr_1 = require("@/lib/tr");
function ParentDashboard() {
    var _a = (0, react_query_1.useQuery)({
        queryKey: ['/api/parent/child'],
    }), parentData = _a.data, parentLoading = _a.isLoading;
    var _b = (0, react_query_1.useQuery)({
        queryKey: ['/api/student', parentData === null || parentData === void 0 ? void 0 : parentData.student.id, 'progress'],
        enabled: !!(parentData === null || parentData === void 0 ? void 0 : parentData.student.id),
    }), _c = _b.data, progressHistory = _c === void 0 ? [] : _c, progressLoading = _b.isLoading;
    if (parentLoading || progressLoading) {
        return ((0, jsx_runtime_1.jsx)(ParentLayout_1.default, { children: (0, jsx_runtime_1.jsx)("div", { className: "flex items-center justify-center h-64", children: (0, jsx_runtime_1.jsx)("div", { className: "animate-spin rounded-full h-12 w-12 border-b-2 border-primary" }) }) }));
    }
    if (!parentData) {
        return ((0, jsx_runtime_1.jsx)(ParentLayout_1.default, { children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center py-12", children: [(0, jsx_runtime_1.jsx)("h2", { className: "text-xl font-semibold text-gray-900", children: tr_1.tr.childInfoNotFound }), (0, jsx_runtime_1.jsx)("p", { className: "text-gray-600 mt-2", children: tr_1.tr.contactAdmin })] }) }));
    }
    var child = parentData.student;
    // Calculate progress statistics
    var totalPages = progressHistory.reduce(function (sum, p) { return sum + p.pagesPlanned; }, 0);
    var completedPages = progressHistory.reduce(function (sum, p) { return sum + p.pagesDone; }, 0);
    var overallProgress = totalPages > 0 ? Math.round((completedPages / totalPages) * 100) : 0;
    // Mock attendance data - in real app this would come from API
    var attendanceStats = {
        present: 19,
        absent: 1,
        excused: 0,
        rate: 95,
    };
    return ((0, jsx_runtime_1.jsx)(ParentLayout_1.default, { children: (0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsx)("div", { children: (0, jsx_runtime_1.jsx)("h1", { className: "text-3xl font-bold text-gray-900", children: tr_1.tr.parentDashboard }) }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: tr_1.tr.myChild }) }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center", children: [(0, jsx_runtime_1.jsx)("div", { className: "h-20 w-20 bg-gray-200 rounded-full flex items-center justify-center", children: (0, jsx_runtime_1.jsx)("svg", { className: "h-8 w-8 text-gray-400", fill: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { d: "M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" }) }) }), (0, jsx_runtime_1.jsxs)("div", { className: "ml-6", children: [(0, jsx_runtime_1.jsxs)("h4", { className: "text-xl font-semibold text-gray-900", children: [child.firstName, " ", child.lastName] }), (0, jsx_runtime_1.jsxs)("p", { className: "text-gray-600", children: [child.class.name, " S\u0131n\u0131f\u0131"] }), (0, jsx_runtime_1.jsxs)("p", { className: "text-sm text-gray-500", children: [child.class.programType.name, " Program\u0131"] })] })] }) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [(0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: tr_1.tr.progressStatus }) }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-center mb-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "relative inline-flex items-center justify-center w-32 h-32 mb-4", children: [(0, jsx_runtime_1.jsxs)("svg", { className: "w-32 h-32 transform -rotate-90", viewBox: "0 0 36 36", children: [(0, jsx_runtime_1.jsx)("path", { className: "text-gray-300", stroke: "currentColor", strokeWidth: "3", fill: "none", d: "M18 2.0845a 15.9155 15.9155 0 0 1 0 31.831a 15.9155 15.9155 0 0 1 0 -31.831" }), (0, jsx_runtime_1.jsx)("path", { className: "".concat(overallProgress >= 90 ? 'text-green-500' : overallProgress >= 50 ? 'text-yellow-500' : 'text-red-500'), stroke: "currentColor", strokeWidth: "3", fill: "none", strokeDasharray: "".concat(overallProgress, ", 100"), d: "M18 2.0845a 15.9155 15.9155 0 0 1 0 31.831a 15.9155 15.9155 0 0 1 0 -31.831" })] }), (0, jsx_runtime_1.jsx)("div", { className: "absolute inset-0 flex items-center justify-center", children: (0, jsx_runtime_1.jsxs)("span", { className: "text-2xl font-bold text-gray-900", children: [overallProgress, "%"] }) })] }), (0, jsx_runtime_1.jsx)("p", { className: "text-gray-600", children: tr_1.tr.overallProgress })] }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-3", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center", children: [(0, jsx_runtime_1.jsx)("span", { className: "text-sm text-gray-600", children: tr_1.tr.completedPages }), (0, jsx_runtime_1.jsxs)("span", { className: "text-sm font-medium text-gray-900", children: [completedPages, " / ", totalPages] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center", children: [(0, jsx_runtime_1.jsx)("span", { className: "text-sm text-gray-600", children: tr_1.tr.currentWeek }), (0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-gray-900", children: "Hafta 5" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center", children: [(0, jsx_runtime_1.jsx)("span", { className: "text-sm text-gray-600", children: tr_1.tr.status }), (0, jsx_runtime_1.jsx)(badge_1.Badge, { className: overallProgress >= 90 ? 'bg-green-100 text-green-800' : overallProgress >= 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800', children: overallProgress >= 90 ? tr_1.tr.successful : overallProgress >= 50 ? tr_1.tr.improving : tr_1.tr.needsAttention })] })] })] })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: tr_1.tr.attendance }) }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-center mb-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-3xl font-bold text-primary mb-2", children: [attendanceStats.rate, "%"] }), (0, jsx_runtime_1.jsx)("p", { className: "text-gray-600", children: tr_1.tr.attendanceRate })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-3 gap-4 text-center", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-green-600", children: attendanceStats.present }), (0, jsx_runtime_1.jsx)("div", { className: "text-xs text-gray-500", children: tr_1.tr.present })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-red-600", children: attendanceStats.absent }), (0, jsx_runtime_1.jsx)("div", { className: "text-xs text-gray-500", children: tr_1.tr.absent })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-yellow-600", children: attendanceStats.excused }), (0, jsx_runtime_1.jsx)("div", { className: "text-xs text-gray-500", children: tr_1.tr.excused })] })] })] })] })] }), (0, jsx_runtime_1.jsxs)(card_1.Card, { children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)(card_1.CardTitle, { children: tr_1.tr.recentProgressRecords }) }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)("div", { className: "overflow-x-auto", children: (0, jsx_runtime_1.jsxs)("table", { className: "min-w-full divide-y divide-gray-200", children: [(0, jsx_runtime_1.jsx)("thead", { className: "bg-gray-50", children: (0, jsx_runtime_1.jsxs)("tr", { children: [(0, jsx_runtime_1.jsx)("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: tr_1.tr.week }), (0, jsx_runtime_1.jsx)("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: tr_1.tr.completed }), (0, jsx_runtime_1.jsx)("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: tr_1.tr.planned }), (0, jsx_runtime_1.jsx)("th", { className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: tr_1.tr.rate })] }) }), (0, jsx_runtime_1.jsx)("tbody", { className: "bg-white divide-y divide-gray-200", children: progressHistory.slice(0, 5).map(function (record) {
                                                var percentage = Math.round((record.pagesDone / record.pagesPlanned) * 100);
                                                return ((0, jsx_runtime_1.jsxs)("tr", { className: "hover:bg-gray-50", children: [(0, jsx_runtime_1.jsxs)("td", { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900", children: ["Hafta ", record.week] }), (0, jsx_runtime_1.jsx)("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-900", children: record.pagesDone }), (0, jsx_runtime_1.jsx)("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-900", children: record.pagesPlanned }), (0, jsx_runtime_1.jsx)("td", { className: "px-6 py-4 whitespace-nowrap", children: (0, jsx_runtime_1.jsx)(ProgressBar_1.default, { percentage: percentage, showText: true }) })] }, record.id));
                                            }) })] }) }) })] })] }) }));
}
